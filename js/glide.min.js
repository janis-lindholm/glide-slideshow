var glide=glide||{};glide.param={},glide.param.name="Slideshow",glide.param.showDuration=5e3,glide.param.animDuration=2e3,glide.param.autoForward=!0,glide.param.bgColor="#1e2426",glide.param.animation="NONE",glide.param.picsJsonURI="pics.json",glide.showTimeoutId=null,glide.lastAnimation=null,glide.animIntervalId=null,glide.cancelAnimation=null,glide.animations={},glide.isScalar=function(i){return/string|number|boolean/.test(typeof i)},glide.randSplice=function(i){var e=Math.floor(Math.random()*i.length),t=i.splice(e,1);return t},glide.randKey=function(i){var e=Object.keys(i),t=Math.floor(Math.random()*e.length);return e[t]},glide.nextPic=function(){return glide.i==glide.max?glide.i=0:glide.i++,[{key:glide.i,src:glide.dataset.pics[glide.i]}]},glide.prevPic=function(){return 0===glide.i?glide.i=glide.max:glide.i--,[{key:glide.i,src:glide.dataset.pics[glide.i]}]},glide.key=function(i){return i.key},glide.calcImgPosAndDims=function(i){var e,t,a,n;null!=i&&(glide.naturalHeight=i.naturalHeight,glide.naturalWidth=i.naturalWidth);var l=window.innerHeight,d=window.innerWidth;if(glide.naturalHeight<=l&&glide.naturalWidth<=d)e=glide.naturalHeight,t=glide.naturalWidth;else{var r=d/glide.naturalWidth,g=l/glide.naturalHeight,o=Math.min(r,g);t=Math.round(glide.naturalWidth*o),e=Math.round(glide.naturalHeight*o)}return a=(d-t)/2,n=(l-e)/2,{width:t,height:e,x:a,y:n}},glide.updateParams=function(){Object.keys(glide.param).forEach(function(i,e){if(glide.dataset.hasOwnProperty(i)){var t=glide.dataset[i];glide.isScalar(t)?(console.log("Using custom slideshow param '"+i+"' : "+t),glide.param[i]=t):console.log("Ignoring invalid slideshow param '"+i+"'.")}})},glide.getRandAnimation=function(){for(var i=glide.lastAnimation;i==glide.lastAnimation;)i=glide.randKey(glide.animations);return glide.lastAnimation=i,i},glide.setupCanvas=function(){d3.select("title").text(glide.param.name),glide.svg=d3.select("body").attr("style","background-color: "+glide.param.bgColor).append("svg").attr("width",window.innerWidth).attr("height",window.innerHeight).attr("id","canvas")},glide.nextSlide=function(){var i=glide.nextPic();glide.showSlide(i)},glide.prevSlide=function(){var i=glide.prevPic();glide.showSlide(i)},glide.showSlide=function(i){glide.param.autoForward&&null!=glide.showTimeoutId&&clearTimeout(glide.showTimeoutId),null!=glide.cancelAnimation&&glide.cancelAnimation();var e=glide.svg.selectAll("image").data(i,glide.key);if("RANDOM"==glide.param.animation){var t=glide.getRandAnimation();glide.animations[t](i,e)}else glide.animations.hasOwnProperty(glide.param.animation)?glide.animations[glide.param.animation](i,e):glide.aniNone(i,e)},glide.picId=function(i){return"pic_"+i.key},glide.picSrc=function(i){return i.src},glide.triggerNextSlide=function(i){glide.param.autoForward&&(glide.showTimeoutId=setTimeout(glide.nextSlide,i))},glide.aniNotImplemented=function(i,e){console.log("This animation is not yet implemented!"),glide.aniNone(i,e)},glide.aniNone=function(i,e){e.exit().remove();var t=new Image;t.onload=function(){var i=glide.calcImgPosAndDims(t);e.enter().append("image").attr("xlink:href",glide.picSrc).attr("id",glide.picId).attr("width",i.width).attr("height",i.height).attr("x",i.x).attr("y",i.y),glide.triggerNextSlide(glide.param.showDuration)},t.src=i[0].src},glide.aniZoomIn=function(i,e){e.exit().remove();var t=new Image;t.onload=function(){var i=glide.calcImgPosAndDims(t);e.enter().append("image").attr("xlink:href",glide.picSrc).attr("id",glide.picId).attr("width",1).attr("height",1).attr("x",window.innerWidth/2).attr("y",window.innerHeight/2).transition().duration(glide.param.animDuration).attr("width",i.width).attr("height",i.height).attr("x",i.x).attr("y",i.y),glide.triggerNextSlide(glide.param.animDuration+glide.param.showDuration)},t.src=i[0].src},glide.aniSlideRight=function(i,e){e.exit().transition().duration(glide.param.animDuration).attr("x",window.innerWidth).remove();var t=new Image;t.onload=function(){var i=glide.calcImgPosAndDims(t);e.enter().append("image").attr("xlink:href",glide.picSrc).attr("id",glide.picId).attr("width",i.width).attr("height",i.height).attr("x",0-i.width).attr("y",i.y).transition().duration(glide.param.animDuration).attr("x",i.x),glide.triggerNextSlide(glide.param.animDuration+glide.param.showDuration)},t.src=i[0].src},glide.aniSlideTop=function(i,e){e.exit().transition().duration(glide.param.animDuration).attr("y",window.innerHeight).remove();var t=new Image;t.onload=function(){var i=glide.calcImgPosAndDims(t);e.enter().append("image").attr("xlink:href",glide.picSrc).attr("id",glide.picId).attr("width",i.width).attr("height",i.height).attr("x",i.x).attr("y",0-i.height).transition().duration(glide.param.animDuration).attr("y",i.y),glide.triggerNextSlide(glide.param.animDuration+glide.param.showDuration)},t.src=i[0].src},glide.getSquareDims=function(i){var e,t,a,n,l,d=8,r=[];i.width>i.height?(e=Math.ceil(i.width/d),t=d,a=Math.ceil(i.height/e)):(e=Math.ceil(i.height/d),a=d,t=Math.ceil(i.width/e)),n=e*t,l=e*a;for(var g=i.x-(n-i.width)/2,o=i.y-(l-i.height)/2,c=0,s=g,m=o,h=1;h<=a;h++){for(var u=1;u<=t;u++)c++,r.push({key:c,x:s,y:m}),s+=e;m+=e,s=g}return{width:e,squares:r}},glide.aniMemory=function(i,e){e.exit().remove();var t=new Image;t.onload=function(){var i=glide.calcImgPosAndDims(t);e.enter().append("image").attr("xlink:href",glide.picSrc).attr("id",glide.picId).attr("width",i.width).attr("height",i.height).attr("x",i.x).attr("y",i.y);var a=glide.getSquareDims(i),n=a.squares,l=100,d=n.length*l;glide.svg.selectAll("rect").data(n,glide.key).enter().append("rect").attr("width",a.width).attr("height",a.width).attr("x",function(i){return i.x}).attr("y",function(i){return i.y}).attr("id",function(i){return"sq_"+i.key}).attr("stroke",glide.param.bgColor).attr("fill",glide.param.bgColor),glide.cancelAnimation=function(){null!=glide.animIntervalId&&(clearInterval(glide.animIntervalId),glide.animIntervalId=null,glide.svg.selectAll("rect").data([],glide.key).exit().remove(),glide.cancelAnimation=null)},glide.animIntervalId=setInterval(function(){n.length>0?(glide.randSplice(n),glide.svg.selectAll("rect").data(n,glide.key).exit().remove()):(clearInterval(glide.animIntervalId),glide.animIntervalId=null,glide.cancelAnimation=null)},l),glide.triggerNextSlide(d+glide.param.showDuration)},t.src=i[0].src},glide.registerAnimations=function(){glide.animations.ZOOM_IN=glide.aniZoomIn,glide.animations.SLIDE_RIGHT=glide.aniSlideRight,glide.animations.SLIDE_TOP=glide.aniSlideTop,glide.animations.MEMORY=glide.aniMemory},glide.startShow=function(i){glide.dataset=i,glide.max=glide.dataset.pics.length-1,glide.i=-1,glide.updateParams(),glide.registerAnimations(),glide.setupCanvas(),glide.nextSlide()},glide.stopShow=function(){null!=glide.showTimeoutId&&(clearTimeout(glide.showTimeoutId),glide.showTimeoutId=null)},d3.select("body").on("click",function(i){glide.nextSlide()}),document.onkeypress=function(i){switch(i=i||window.event,i.key){case" ":glide.nextSlide();break;case"Backspace":glide.prevSlide();break;case"ArrowDown":glide.prevSlide();break;case"ArrowUp":glide.nextSlide();break;case"ArrowLeft":glide.prevSlide();break;case"ArrowRight":glide.nextSlide();break;case"Enter":glide.nextSlide();break;case"Escape":glide.stopShow();break;default:return}},window.onresize=function(i){if(null!=glide.svg){glide.svg.attr("width",window.innerWidth).attr("height",window.innerHeight);var e=glide.calcImgPosAndDims();glide.svg.selectAll("image").attr("width",e.width).attr("height",e.height).attr("x",e.x).attr("y",e.y)}},d3.json(glide.param.picsJsonURI,function(i){glide.startShow(i)});